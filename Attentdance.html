<!DOCTYPE html>
<html>
<head>
  <title>Form Submission</title>

  <style>
    #tasks-table {
            border-collapse: collapse;
            width: 100%;
        }

        #tasks-table th,
        #tasks-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #tasks-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
  </style>
</head>
<body>
  <h1>Form Submission</h1>
  <form method="POST" action="http://localhost:5501/submit-task">
    <label for="date">Date:</label>
    <input type="number" id="date" name="date" required><br>

    <label for="male">Male:</label>
    <input type="number" id="male" name="male" required><br>

    <label for="female">Female:</label>
    <input type="number" id="female" name="female" required><br>

    <label for="total">Total:</label>
    <input type="number" id="total" name="total" required><br>

    <label for="w_female">W_Female:</label>
    <input type="number" id="w_female" name="w_female" required><br>

    <label for="w_male">W_Male:</label>
    <input type="number" id="w_male" name="w_male" required><br>

    <button type="submit">Submit</button>
  </form>

  <table id="tasks-table">
    <thead>
        <tr>
            <th>date</th>
            <th>male</th>
            <th>female</th>
            <th>total</th>
            <th>w_female</th>
            <th>w_male</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

  <script>
      document.addEventListener('DOMContentLoaded', () => {
            
            const tasksTableBody = document.querySelector('#tasks-table tbody');

        // Function to fetch and display tasks
        const fetchAndDisplayTasks = () => {
            fetch('http://localhost:5501/tasks')
                .then(response => response.json())
                .then(tasks => {
                    tasksTableBody.innerHTML = ''; // Clear existing table rows
    
                    tasks.forEach(task => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${task.date}</td>
                            <td>${task.male}</td>
                            <td>${task.female}</td>
                            <td>${task.total}</td>
                            <td>${task.w_female}</td>
                            <td>${task.w_male}</td>
                        `;
                        tasksTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error retrieving tasks:', error));
        };
    
        // Fetch tasks when the page loads
        fetchAndDisplayTasks();
    
        // Handle form submission
        const form = document.querySelector('form');
        form.addEventListener('submit', event => {
            event.preventDefault();
    
            const formData = new FormData(form);
            const taskData = {
                date: formData.get('date'),
                male: formData.get('male'),
                female: formData.get('female'),
                total: formData.get('total'),
                w_female: formData.get('w_female'),
                w_male: formData.get('w_male')
            };
    
            fetch('http://localhost:5501/submit-task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(taskData)
            })
            .then(response => {
                if (response.ok) {
                    console.log('Record inserted successfully.');
                    form.reset();
                    fetchAndDisplayTasks(); // Update the display with the new task
                } else {
                    console.error('Error inserting record.');
                }
            })
            .catch(error => console.error('Error inserting record:', error));
        });

    });
</script>
</body>
</html>
